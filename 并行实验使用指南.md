# 并行实验使用指南

## 🚀 快速开始

### 1. 启动并行实验
```bash
# 基础用法：运行所有6个等级
python parallel_experiment.py

# 自定义种子和回合数
python parallel_experiment.py --seeds 42,123,2024 --episodes 2000

# 指定并行进程数（默认6个）
python parallel_experiment.py --processes 4
```

### 2. 监控实验进度
```bash
# 在另一个终端窗口运行监控器
python monitor_parallel.py

# 指定刷新间隔
python monitor_parallel.py --interval 60
```

## 🎯 并行实验优势

### ⚡ 时间节省
- **串行执行**：6个等级 × 5个种子 × 3000回合 = 大约18-24小时
- **并行执行**：6个等级同时运行 = 大约3-4小时

### 🔧 资源利用
- **CPU**：充分利用多核心处理器
- **GPU**：智能显存分配，避免冲突
- **内存**：每个进程独立的内存空间

## 📊 输出结构

```
parallel_experiment_results/
├── basic/
│   ├── basic_seed42_proc1234_20250814_150000/
│   ├── basic_seed123_proc1234_20250814_160000/
│   └── ...
├── load_efficiency/
├── role_specialization/
├── collaboration/
├── behavior_shaping/
├── full/
├── temp_files/                    # 临时文件目录（实验完成后自动清理）
│   ├── config_basic_1234.py
│   ├── run_basic_1234.py
│   └── ...
└── parallel_experiment_summary.json
```

### 🧹 文件管理
- **临时文件**：统一存放在 `temp_files/` 目录
- **自动清理**：实验完成后自动删除临时文件
- **项目整洁**：不会在项目根目录留下临时文件

## ⚙️ 系统要求

### 最低配置
- **CPU**：4核心以上
- **内存**：16GB以上
- **GPU**：11GB显存（如你的配置）

### 推荐配置
- **CPU**：8核心以上
- **内存**：32GB以上
- **GPU**：RTX 3080/4080或更高

## 🔍 监控指标

### 系统资源
- CPU使用率：建议保持在 < 80%
- 内存使用：建议保持在 < 85%
- GPU显存：自动分配，每个进程约1.5-2GB

### 实验进度
- 各等级完成状态
- 成功/失败统计
- 预计剩余时间

## ⚠️ 注意事项

### 1. 资源管理
```python
# 如果遇到资源不足，减少并行进程数
python parallel_experiment.py --processes 4  # 减少到4个进程
```

### 2. 显存优化
- 每个进程使用独立的GPU内存空间
- 自动检测可用显存并分配
- 如有问题，会自动降级到CPU运行

### 3. 异常处理
- 单个进程失败不影响其他进程
- 自动重试机制（可配置）
- 详细的错误日志记录

## 🛠️ 高级用法

### 自定义实验等级
```python
# 修改 parallel_experiment.py 中的 experiment_levels
experiment_levels = [
    RewardExperimentConfig.BASIC,
    RewardExperimentConfig.COLLABORATION,
    RewardExperimentConfig.FULL
]  # 只运行3个等级
```

### GPU分配策略
```python
# 环境变量方式指定GPU
export CUDA_VISIBLE_DEVICES=0  # 只使用GPU 0
python parallel_experiment.py
```

### 内存优化
```python
# 减少批量大小（如果内存不足）
# 在 parallel_experiment.py 中修改
BATCH_SIZE = 384  # 从512减少到384
```

## 🔧 故障排除

### 常见问题

#### 1. 显存不足
```bash
# 解决方案1：减少并行进程数
python parallel_experiment.py --processes 3

# 解决方案2：减少批量大小
# 修改 parallel_experiment.py 中的 BATCH_SIZE = 384
```

#### 2. CPU使用率过高
```bash
# 减少进程数
python parallel_experiment.py --processes 4
```

#### 3. 进程卡死
```bash
# 查看监控器输出，检查具体哪个进程有问题
python monitor_parallel.py

# 如果需要，可以手动终止特定进程
```

## 📈 性能调优建议

### 1. 硬件优化
- **SSD存储**：提高I/O性能
- **快速内存**：DDR4-3200或更高
- **良好散热**：保持CPU/GPU温度稳定

### 2. 软件优化
- **关闭不必要程序**：释放CPU和内存资源
- **设置高性能模式**：Windows电源选项
- **禁用Windows更新**：避免实验中断

### 3. 参数调优
```python
# 可以尝试的优化参数
BATCH_SIZE = 768        # 如果显存足够
UPDATE_EVERY = 2        # 减少更新频率
CAPACITY = 50000        # 减少经验池大小
```

## 📊 结果分析

实验完成后，使用现有的分析工具：

```bash
# 多种子分析
python multi_seed_analyzer.py

# 实验对比分析
python experiment_analyzer.py
```

## 🎉 预期效果

使用并行实验，你应该能看到：
- **时间节省**: 75-80% 的时间节省
- **资源利用**: 更好的硬件利用率
- **结果一致**: 与串行实验相同的质量
- **易于监控**: 实时进度显示
